@model IEnumerable<IC2020.Models.Item>

@{
    ViewBag.Title = "DashBoard";
}

<link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<script src="@Url.Content("~/Scripts/jquery-1.10.2.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>

<script type="text/javascript" src="~/chart/Chart.PieceLabel.js"></script>

@*<script type="text/jscript">
        var url = "/Home/GetDate1";
        $.get(url, null, function (data) {
            $("#valueDate1").html(data);
        });
    </script>*@
    <script type="text/jscript">
        var url = "/Repositories/GetNameRepo";
        $.get(url, null, function (data) {
            $("#valueDateC").html(data);
        });
    </script>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="info-box bg-danger">
                    <span class="info-box-icon"><i class="far fa-flag"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text">USUÁRIO/REPOSITÓRIO</span>
                        <span class="info-box-text"id="valueDateC"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">

                <div class="card card-danger card-outline">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="far fa-chart-bar"></i>
                            DESENVOLVEDORES DE CADA VERSÃO
                        </h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="example1" class="table table-hover" height="100">
                                @if (Model.Count() == 0)
                                    {
                                        <tr>
                                            <td colspan="10">Não foram encontrados dados.</td>
                                        </tr>

                                    }
                                    else
                                    {
                                <thead>
                                    <tr style="background-color:#DE022A; color:white">
                                        <th scope="col">Desenvolvedor</th>
                                        <th scope="col">Versão</th>
                                        <th scope="col">Data</th>
                                    </tr>
                                </thead>                              

                                foreach (var item in Model)
                                    {
                                        <tr >
                                            <td>@item.author.login</td>
                                            <td>@item.tag_name</td>
                                            <td>@item.published_at</td>                                           
                                        </tr>
                                    }
                                 }
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card card-danger card-outline">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="far fa-chart-bar"></i>
                            TOTAL DE COMMITS DE CADA VERSÃO
                        </h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="wrapper">
                            <canvas id="totalChart" height="303"></canvas>
                            <script>
                                //fetch('/Home/GetChart')
                                //    .then(res => res.json())
                                //    .then(data => {
                                //        console.log(data)
                                //        const name = data.map(x => x.name)
                                //        const total = data.map(x => parseInt(x.total))
                                var ctx = document.getElementById("totalChart");
                                var chart = new Chart(ctx, {
                                    type: 'pie',
                                    data: {
                                        datasets: [{ backgroundColor: ['rgb(255, 99, 132)', 'rgb(255, 199, 132)', 'rgb(55, 99, 132)', 'rgba(0, 255, 0, 0.3)', "#8e5ea2"], data: [10, 5, 3, 15, 1] }], labels: ["v14.11.0", "v14.10.1", "v14.10.0", "v12.18.4", "v10.22.1",]
                                    },
                                    options: {
                                        responsive: true,
                                        title: {
                                            display: true,
                                            responsive: true
                                        },
                                        pieceLabel: {
                                            render: 'value',
                                            position: 'outside',
                                            segment: true,
                                            fontSize: 14,
                                            fontStyle: 'bold',
                                            fontColor: '#000',
                                            //fontFamily: '"Lucida Console", Monaco, monospace'
                                        }
                                    }
                                });
                                //})
                                //.catch(err => console.log('err =>', err));
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @*<div class="row">
                <div class="col-12">
                    <div class="info-box bg-danger">
                        <span class="info-box-icon"><i class="far fa-calendar-alt"></i></span>
                        <div class="info-box-content">
                            <span class="info-box-text">ÚLTIMA DATA DA PLUVIOMÊTRIA EXTRAÍDA, DA PREFEITURA DE SANTOS, PARA MAIS DETALHES CONSULTE <a href="https://www.santos.sp.gov.br/?q=pluviometria-tabela">O SITE.</a></span>
                            <span class="info-box-text" id="valueDate1"></span>
                        </div>
                    </div>
                </div>
            </div>*@
        <div class="row">
            <div class="col-12">
                <div class="card card-danger card-outline">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="far fa-chart-bar"></i>
                            DATA x VERSÃO
                        </h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="wrapper">
                            <canvas id="mixed-chart" width="800" height="400"></canvas>
                            <script>
                                //fetch('/Home/GetPluviometricHtml')
                                //    .then(res => res.json())
                                //    .then(data1 => {
                                //        console.log(data1)
                                //        const dataM = data1.map(x => x.dataM)
                                //        const totalDia = data1.map(x => parseInt(x.totalDia))
                                //        const pluviometrico = data1.map(x => parseInt(x.pluviometro))
                                //        console.log(totalDia)
                                //        console.log(pluviometrico)

                                //new Chart(document.getElementById("mixed-chart"), {
                                //    type: 'bar',
                                //    data: {
                                //        label: "FALSEK (TOTAL DIA ANTERIOR)",
                                //        datasets: [{ backgroundColor: "rgba(255,0,0,0.3)", data: totalDia, label: "FALSEK (TOTAL DIA ANTERIOR)", },
                                //        {
                                //            label: "PLUVIÔMETRO (MM)",
                                //            type: "line",
                                //            borderColor: "#8e5ea2",
                                //            data: pluviometrico,
                                //            fill: false
                                //        },

                                //        ], labels: dataM
                                //    },
                                //    options: {
                                //        responsive: true,
                                //        title: {
                                //            display: true,
                                //            responsive: true
                                //        }
                                //    }
                                //});
                                new Chart(document.getElementById("mixed-chart"), {
                                    type: 'line',
                                    data: {
                                        labels: ["v14.11.0", "v14.10.1", "v14.10.0", "v12.18.4", "v10.22.1"],
                                        datasets: [{

                                            data: [5, 2, 1, 0, 0],
                                            label: "Versão",
                                            borderColor: "#8e5ea2",
                                            fill: false
                                        },
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        title: {
                                            display: true,
                                            text: 'INTERVALO DE TEMPO ENTRE AS VERSÕES',
                                            responsive: true
                                        }
                                    }
                                });



                                                                                            //})
                                                                                            //.catch(err => console.log('err =>', err));
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
